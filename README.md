# Scrolling Screenshot (Edge) v1.0.0

在网页中选择区域并进行滚动截图、自动拼接，并支持简单标注与保存。本扩展基于 Manifest V3，所有截图与拼接均在本地完成，不会上传到网络。

## 主要功能

- 三种捕获模式：
  - 区域捕获：框选视口区域后，手动滚动页面，扩展自动分片截图并无缝拼接。
  - 整页捕获：自动识别滚动容器并从顶部到底部连续截图与拼接。
  - 容器捕获：指定某个可滚动容器（包含同源 iframe 内的滚动容器）进行连续截图与拼接。
- 自动识别滚动容器：支持检测 `document.scrollingElement`、普通元素滚动容器，以及同源 iframe 内部的滚动容器。
- 重叠估计与无缝拼接：通过像素均方差估计相邻截图的重叠区域，减少接缝与重复内容。
- 页面内预览：截图完成后在当前页面弹出预览覆盖层，可直接保存到本地。
- 标注页（可选）：`annotate.html` 提供简单的画线与缩放功能，可将最终图另存为 PNG。

## 安装（加载未打包的扩展）

1. 打开 Edge 浏览器，访问 “设置 > 扩展 > 管理扩展”。
2. 打开右上角 “开发人员模式”。
3. 点击 “加载解压缩的扩展”，选择目录：`UserPath\edge_extension`。
4. 扩展安装后，工具栏会出现图标，点击即可打开弹窗。

## 使用方法

1. 进入需要截图的网页，点击工具栏扩展图标打开弹窗。
2. 点击 “初始化页面脚本”，确保内容脚本已注入当前网页（某些浏览器内部页面无法注入）。
3. 选择捕获方式：
   - 区域捕获：
     1) 点击 “选择区域” 在页面中框选要截取的矩形区域；
     2) 点击 “开始区域捕获”，随后用鼠标或触控板手动滚动页面；
     3) 完成后点击 “停止”，将弹出预览覆盖层，选择 “保存到本地…” 即可。
   - 容器捕获：
     1) 点击 “选择滚动容器”，在页面中点击目标容器（如列表、评论区等）；
     2) 或点击 “自动检测滚动条并绑定” 由扩展自动选择优先容器；
     3) 点击 “捕获容器”，自动从容器顶部到底部进行连续截图；
     4) 完成后点击 “停止”，在预览覆盖层保存。
   - 整页捕获：
     1) 直接点击 “捕获整页”，扩展将自动识别主要滚动容器并执行；
     2) 完成后点击 “停止”，在预览覆盖层保存。

4. 重叠估计高度：可在弹窗底部设置（默认 120 像素）。此值用于分片拼接时的重叠参考，页面内容密集或存在固定头部/页脚时可适当调整。
5. 标注（可选）：
   - 当前版本默认在页面内预览并保存，未自动打开标注页；
   - 若需标注，可在扩展目录中打开 `annotate.html`（加载后会尝试读取最后一次截图），支持画线、缩放与另存为 PNG。

## 权限说明

- `activeTab`、`tabs`、`scripting`：用于在当前网页注入脚本与与内容脚本通信。
- `downloads`：用于将最终截图保存到本地。
- `storage`：用于临时存储最后一次生成的截图数据（仅在本地）。
- `host_permissions: <all_urls>`：允许在常见网页域名上运行内容脚本与执行截图。

## 隐私与本地处理

扩展不会将截图或页面内容发送到任何服务器。所有截图、拼接与预览均在本地浏览器中完成。仅在用户选择 “保存到本地…” 时，通过浏览器的下载接口将图像文件保存到本机。

## 常见问题与限制

- 跨域 iframe：由于浏览器安全策略，无法访问跨域 iframe 的内容与滚动状态，容器检测将跳过跨域 iframe。
- 超长页面与内存占用：极长页面可能导致内存占用较高；如遇性能问题，可分段截图或提高重叠估计值以减少分片数量。
- 固定头部/页脚：页面固定栏可能导致拼接处出现重复或覆盖，可尝试调整重叠估计高度或使用区域/容器模式规避。
- 不支持注入的页面：例如浏览器内置页面（edge://、chrome://）或某些系统页面无法注入内容脚本，请在普通网页上使用。

## 版本与更新日志

- v1.0.0
  - 将当前稳定功能作为 1.0.0 版本发布：区域/整页/容器捕获、自动容器识别、重叠估计拼接、页面内预览、可选标注页。

## 项目结构（简要）

- `manifest.json`：扩展清单（MV3）。
- `background.js`：后台服务工作线程，负责可视区截图、下载与数据存储。
- `content.js`：内容脚本，负责区域选择、容器选择、滚动与拼接、页面内预览。
- `popup.html / popup.js`：弹窗界面与交互逻辑。
- `annotate.html / annotate.js`：可选的标注页（画线、缩放与保存）。
- `icons/`：扩展图标。

## 许可证

本项目采用 MIT 许可证开源。详细条款见仓库根目录的 `LICENSE` 文件。

——
如需将图标或 README 文案用于商店发布，请根据实际产品名称与发布政策进行适当调整。